--REGION  Village Level Rate
select 'VILLAGE' LEVEL_NAME, a.Report_Month, a.Modality,sum(a.CVC_NUMERATOR_VALUE) CVC_NUMERATOR_VALUE, sum(a.CVC_DENOMINATOR_VALUE) CVC_DENOMINATOR_VALUE
from(
	SELECT PERIOD_DATE_DIM_SEQ Report_Month, MODALITY_GROUP Modality, CVC_NUMERATOR_VALUE, CVC_DENOMINATOR_VALUE
    FROM VIEW_DB..IQI_VILLAGE_SCORE_FACT_FLAT_VW 
  	where DATASET_DATE_DIM_SEQ = (select max(DATASET_DATE_DIM_SEQ) from VIEW_DB..IQI_VILLAGE_SCORE_FACT_FLAT_VW where RULE_SET_DIM_SEQ = 28) and RULE_SET_DIM_SEQ = 28 and PERIOD_DATE_DIM_SEQ >= 20180131 and modality_group = 'HD'
  	union all
  	SELECT PERIOD_DATE_DIM_SEQ Report_Month, MODALITY_GROUP Modality, CVC_NUMERATOR_VALUE, CVC_DENOMINATOR_VALUE
    FROM VIEW_DB..VILLAGE_DQI_SCORE_FACT_FLAT_MON_VW 
  	where DATASET_DATE_DIM_SEQ = (select max(DATASET_DATE_DIM_SEQ) from VIEW_DB..VILLAGE_DQI_SCORE_FACT_FLAT_MON_VW) and PERIOD_DATE_DIM_SEQ >= 20180131 and modality_group = 'HD'
	) a
group by 1, 2, 3
--END REGION
;

--REGION Group Level Rate
select GROUPNAME, a.Report_Month, a.Modality,sum(a.CVC_NUMERATOR_VALUE) CVC_NUMERATOR_VALUE, sum(a.CVC_DENOMINATOR_VALUE) CVC_DENOMINATOR_VALUE
from(
	SELECT PERIOD_DATE_DIM_SEQ Report_Month, MODALITY_GROUP Modality, CVC_NUMERATOR_VALUE, CVC_DENOMINATOR_VALUE, GROUPNAME
    FROM VIEW_DB..IQI_GROUP_SCORE_FACT_FLAT_VW 
  	where DATASET_DATE_DIM_SEQ = (select max(DATASET_DATE_DIM_SEQ) from VIEW_DB..IQI_GROUP_SCORE_FACT_FLAT_VW where RULE_SET_DIM_SEQ = 28) and RULE_SET_DIM_SEQ = 28 and PERIOD_DATE_DIM_SEQ >= 20180131 and modality_group = 'HD' AND GROUPNAME = 'Titan'
  	union all
  	SELECT PERIOD_DATE_DIM_SEQ Report_Month, MODALITY_GROUP Modality, CVC_NUMERATOR_VALUE, CVC_DENOMINATOR_VALUE, GROUPNAME
    FROM VIEW_DB..GROUP_DQI_SCORE_FACT_FLAT_MON_VW
  	where DATASET_DATE_DIM_SEQ = (select max(DATASET_DATE_DIM_SEQ) from VIEW_DB..GROUP_DQI_SCORE_FACT_FLAT_MON_VW) and PERIOD_DATE_DIM_SEQ >= 20180131 and modality_group = 'HD' AND GROUPNAME = 'Titan'
	) a
group by 1, 2, 3
--END REGION
;

--REGION Division Level Rates
select DIVISIONNAME, a.Report_Month, a.Modality,sum(a.CVC_NUMERATOR_VALUE) CVC_NUMERATOR_VALUE, sum(a.CVC_DENOMINATOR_VALUE) CVC_DENOMINATOR_VALUE
from(
	SELECT PERIOD_DATE_DIM_SEQ Report_Month, MODALITY_GROUP Modality, CVC_NUMERATOR_VALUE, CVC_DENOMINATOR_VALUE, DIVISIONNAME
    FROM VIEW_DB..IQI_DIVISION_SCORE_FACT_FLAT_VW 
  	where DATASET_DATE_DIM_SEQ = (select max(DATASET_DATE_DIM_SEQ) from VIEW_DB..IQI_DIVISION_SCORE_FACT_FLAT_VW where RULE_SET_DIM_SEQ = 28) and RULE_SET_DIM_SEQ = 28 and PERIOD_DATE_DIM_SEQ >= 20180131 and modality_group = 'HD' AND GROUPNAME = 'Titan'
  	union all
  	SELECT PERIOD_DATE_DIM_SEQ Report_Month, MODALITY_GROUP Modality, CVC_NUMERATOR_VALUE, CVC_DENOMINATOR_VALUE, DIVISIONNAME
    FROM VIEW_DB..DIVISION_DQI_SCORE_FACT_FLAT_MON_VW
  	where DATASET_DATE_DIM_SEQ = (select max(DATASET_DATE_DIM_SEQ) from VIEW_DB..DIVISION_DQI_SCORE_FACT_FLAT_MON_VW) and PERIOD_DATE_DIM_SEQ >= 20180131 and modality_group = 'HD' AND GROUPNAME = 'Titan'
	) a
group by 1, 2, 3
--END REGION
;
